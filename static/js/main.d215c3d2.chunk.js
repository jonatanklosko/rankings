(this.webpackJsonprankings=this.webpackJsonprankings||[]).push([[0],{152:function(e,t,a){e.exports=a(355)},157:function(e,t,a){},239:function(e,t,a){},348:function(e,t,a){},355:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(19),i=a.n(o),s=(a(157),a(18)),c=a(148),l=a.n(c),m=a(17),d=a.n(m),h=a(44),p=a(146),g=a.n(p),u=a(147),E=a.n(u),v=a(136),f=a.n(v),w=a(138),k=a.n(w),b=a(21),y=a.n(b),C=a(23),x=a.n(C);class P extends n.Component{render(){return r.a.createElement(f.a,{position:"static",color:"primary"},r.a.createElement(k.a,null,r.a.createElement(y.a,{variant:"h6",color:"inherit",style:{flexGrow:1}},r.a.createElement(s.b,{to:"/"},"Rankings")),r.a.createElement(x.a,{component:"a",href:"https://github.com/jonatanklosko/rankings",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:"https://png.icons8.com/ios-glyphs/32/ffffff/github.png",alt:"GitHub"}))))}}var S=a(45),R=a.n(S);const I=e=>{const t=new Date(null);return t.setMilliseconds(10*e),t.toISOString().substr(11,11).replace(/^[0:]*(?!\.)/g,"")},j=e=>{const t=new URLSearchParams(e);return{wcaIds:t.get("wcaids")?(a=t.get("wcaids").split(","),[...new Set(a)]):[],name:t.get("name")||""};var a},D=({name:e,wcaIds:t})=>new URLSearchParams({name:e,wcaids:t.join(",")}).toString();class N extends n.Component{constructor(...e){super(...e),this.state={redirectPath:null},this.importPeople=()=>{this.fileInput.click()},this.handleFileChange=e=>{var t;e.target.files.length>0&&(t=e.target.files[0],new Promise((e,a)=>{const n=new FileReader;n.onload=t=>{const a=t.target.result;e(a.match(/\d{4}[A-Za-z]{4}\d{2}/g)||[])},n.onerror=a,n.readAsText(t)})).then(e=>this.setState({redirectPath:"/edit?"+D({name:"",wcaIds:e})}))}}render(){const e=this.state.redirectPath;return e?r.a.createElement(s.c,{to:e}):r.a.createElement(d.a,{container:!0,spacing:24,justify:"center"},r.a.createElement(d.a,{item:!0},r.a.createElement(y.a,{variant:"h4"},"What is it?")),r.a.createElement(d.a,{item:!0},r.a.createElement(y.a,{variant:"subtitle1"},r.a.createElement("a",{href:"https://www.worldcubeassociation.org/results/events.php",target:"_blank",rel:"noopener noreferrer"},"WCA"),"-like rankings created by you! Select a group of people and see how they are doing compared to each other.")),r.a.createElement(d.a,{item:!0},r.a.createElement(d.a,{container:!0,spacing:8},r.a.createElement(d.a,{item:!0},r.a.createElement(R.a,{variant:"outlined",component:s.b,to:"/edit"},"Go ahead and create one!")),r.a.createElement("input",{type:"file",style:{display:"none"},ref:e=>this.fileInput=e,onChange:this.handleFileChange}),r.a.createElement(d.a,{item:!0},r.a.createElement(R.a,{variant:"outlined",onClick:this.importPeople},"Import people from file")))))}}var O=a(63),B=a(59),F=a.n(B),U=a(62),A=a.n(U),W=a(8),M=a.n(W),T=a(151),L=a(149);const q=new Map,_=e=>{const t=M.a.partition(e,e=>q.has(e)),a=Object(L.a)(t,2),n=a[0],r=a[1].slice(0,500),o=M.a.map(n,e=>q.get(e)),i=M.a.map(M.a.chunk(r,100),e=>z("/persons?per_page=100&wca_ids=".concat(e.join(","))));return Promise.all(i).then(M.a.flatten).then(e=>e.map(e=>{let t=e.personalRecords,a=Object(T.a)(e,["personalRecords"]);return Object(O.a)({},a,{personalRecords:M.a.mapKeys(t,(e,t)=>M.a.toLower(t))})})).then(e=>(M.a.each(e,e=>q.set(e.person.wcaId,e)),e.concat(o)))},z=(e,t={})=>fetch("".concat("https://www.worldcubeassociation.org/api/v0").concat(e),t).then(e=>e.json()).then(H),H=e=>M.a.isArray(e)?M.a.map(e,H):M.a.mapValues(M.a.mapKeys(e,(e,t)=>M.a.camelCase(t)),e=>M.a.isObject(e)?H(e):e);var J=a(84),G=a.n(J),K=a(85),V=a.n(K),Z=a(140),$=a.n(Z),Q=a(61),X=a.n(Q),Y=a(60),ee=a.n(Y),te=a(35),ae=a.n(te),ne=a(27),re=a.n(ne),oe=a(139),ie=a.n(oe),se=a(150);a(239);class ce extends n.Component{constructor(e){super(e),this.state={peopleFound:[]},this.findPeople=e=>{e?(e=>z("/search/users?persons_table=true&q=".concat(e)).then(e=>e.result))(e).then(e=>this.setState({peopleFound:e})):this.setState({peopleFound:[]})},this.handleChange=(e,{clearSelection:t})=>{const a=this.props,n=a.onChange,r=a.clearOnChange;e&&n(e),r&&t()},this.findPeopleDebounced=M.a.debounce(this.findPeople,300)}render(){const e=this.props,t=e.fullWidth,a=e.label;return r.a.createElement(se.a,{onChange:this.handleChange,itemToString:e=>M.a.get(e,"name",""),onInputValueChange:this.findPeopleDebounced},({getInputProps:e,getItemProps:n,isOpen:o,inputValue:i,highlightedIndex:s})=>r.a.createElement("div",{className:"wca-person-select"},r.a.createElement(F.a,e({fullWidth:t,label:a})),o&&r.a.createElement(re.a,{square:!0,className:"options-list"},this.state.peopleFound.map((e,t)=>r.a.createElement(ie.a,n({item:e,selected:s===t,key:e.id}),r.a.createElement(ee.a,{src:e.avatar.thumbUrl}),r.a.createElement(X.a,{primary:e.name,secondary:e.wcaId}))))))}}class le extends n.PureComponent{onPersonAdded(e){this.props.onChange(M.a.uniqBy([...this.props.people,e],"wcaId"))}onPersonRemoved(e){this.props.onChange(M.a.reject(this.props.people,{wcaId:e.wcaId}))}render(){return r.a.createElement(re.a,{elevation:1,style:{padding:8}},r.a.createElement(d.a,{container:!0,spacing:8},r.a.createElement(d.a,{item:!0,xs:12},r.a.createElement(ce,{fullWidth:!0,label:"Add person",clearOnChange:!0,onChange:e=>this.onPersonAdded(e)})),r.a.createElement(d.a,{item:!0,xs:12},r.a.createElement(G.a,{dense:!0,style:{maxHeight:200,overflow:"auto"}},M.a.sortBy(this.props.people,"name").map(e=>r.a.createElement(V.a,{key:e.wcaId},r.a.createElement(ee.a,{src:e.avatar.thumbUrl}),r.a.createElement(X.a,{primary:e.name}),r.a.createElement($.a,null,r.a.createElement(x.a,{onClick:()=>this.onPersonRemoved(e)},r.a.createElement(ae.a,null,"delete")))))))))}}class me extends n.Component{constructor(e){super(e),this.handleSubmit=e=>{e.preventDefault();const t=this.state,a=t.ranking,n=t.people;this.setState({redirectPath:"/show?"+D({name:a.name,wcaIds:M.a.map(n,"wcaId")})})},this.handleNameChange=e=>{const t=this.state.ranking;this.setState({ranking:Object(O.a)({},t,{name:e.target.value})})},this.handlePeopleChange=e=>{this.setState({people:e})},this.state={ranking:j(e.location.search),people:[],redirectPath:null,loading:!0}}componentDidMount(){_(this.state.ranking.wcaIds).then(e=>this.setState({loading:!1,people:M.a.map(e,"person")}))}render(){const e=this.state,t=e.redirectPath,a=e.ranking,n=e.people,o=e.loading;return t?r.a.createElement(s.c,{to:t}):r.a.createElement("div",null,r.a.createElement(y.a,{variant:"h5"},"Edit ranking"),r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(d.a,{container:!0,direction:"column",spacing:16},r.a.createElement(d.a,{item:!0},r.a.createElement(F.a,{fullWidth:!0,label:"Ranking name",value:a.name,onChange:this.handleNameChange})),r.a.createElement(d.a,{item:!0},r.a.createElement(y.a,{variant:"subtitle2",style:{marginBottom:8}},"People"),o?r.a.createElement(A.a,null):r.a.createElement(le,{people:n,onChange:this.handlePeopleChange})),r.a.createElement(d.a,{item:!0},r.a.createElement(R.a,{type:"submit",variant:"outlined"},"Done")))))}}var de=a(36),he=a.n(de),pe=a(141),ge=a.n(pe),ue=a(142),Ee=a.n(ue);var ve=[{id:"333",name:"Rubik's Cube",icon:"event-333"},{id:"222",name:"2x2x2 Cube",icon:"event-222"},{id:"444",name:"4x4x4 Cube",icon:"event-444"},{id:"555",name:"5x5x5 Cube",icon:"event-555"},{id:"666",name:"6x6x6 Cube",icon:"event-666"},{id:"777",name:"7x7x7 Cube",icon:"event-777"},{id:"333bf",name:"3x3x3 Blindfolded",icon:"event-333bf"},{id:"333fm",name:"3x3x3 Fewest Moves",icon:"event-333fm"},{id:"333oh",name:"3x3x3 One-Handed",icon:"event-333oh"},{id:"333ft",name:"3x3x3 With Feet",icon:"event-333ft"},{id:"minx",name:"Megaminx",icon:"event-minx"},{id:"pyram",name:"Pyraminx",icon:"event-pyram"},{id:"clock",name:"Rubik's Clock",icon:"event-clock"},{id:"skewb",name:"Skewb",icon:"event-skewb"},{id:"sq1",name:"Square-1",icon:"event-sq1"},{id:"444bf",name:"4x4x4 Blindfolded",icon:"event-444bf"},{id:"555bf",name:"5x5x5 Blindfolded",icon:"event-555bf"},{id:"333mbf",name:"3x3x3 Multi-Blind",icon:"event-333mbf"}];class fe extends n.Component{render(){return r.a.createElement("div",null,ve.map(e=>r.a.createElement(he.a,{title:e.name,placement:"top",key:e.id},r.a.createElement(x.a,{onClick:()=>this.props.onChange(e)},r.a.createElement("span",{className:"cubing-icon ".concat(e.icon),style:{opacity:e.id===this.props.value.id?1:.3}})))))}}var we=a(143),ke=a.n(we),be=a(145),ye=a.n(be),Ce=a(24),xe=a.n(Ce),Pe=a(144),Se=a.n(Pe),Re=a(86),Ie=a.n(Re);a(348);class je extends n.Component{constructor(...e){super(...e),this.state={format:"single"}}setFormat(e){this.setState({format:e})}formattedPersonalBest(e,t){const a=this.props.event,n=M.a.get(e,"personalRecords.".concat(a.id,".").concat(t,".best"));return n?((e,t,a)=>{if("333fm"!==t){if("333mbf"===t){const t=e%100,a=(e=Math.floor(e/100))%1e5,n=99-(e=Math.floor(e/1e5))%100+t,r=n+t,o=I(100*a).replace(/\.00$/,"");return"".concat(n,"/").concat(r," ").concat(o)}return I(e)}switch(a){case"single":return e;case"average":return(e/100).toFixed(2);default:throw new Error("Unrecognized format type: ".concat(a))}})(n,a.id,t):""}peopleDataForEvent(){const e=this.props,t=e.event,a=e.peopleData,n=this.state.format;return M()(a).filter("personalRecords.".concat(t.id,".").concat(n)).orderBy(["personalRecords.".concat(t.id,".").concat(n,".localRank")]).value()}render(){const e=this.state.format;return r.a.createElement("div",{className:"ranking-table-container"},r.a.createElement(ke.a,{className:"sort-by-".concat(e)},r.a.createElement(Se.a,{className:"ranking-table-head"},r.a.createElement(Ie.a,null,r.a.createElement(xe.a,{padding:"dense"}),r.a.createElement(xe.a,null,"Name"),r.a.createElement(xe.a,{numeric:!0,className:"single",onClick:()=>this.setFormat("single")},"Single"),r.a.createElement(xe.a,{numeric:!0,className:"average",onClick:()=>this.setFormat("average")},"Average"))),r.a.createElement(ye.a,null,this.peopleDataForEvent().map(t=>r.a.createElement(Ie.a,{key:t.person.wcaId},r.a.createElement(xe.a,{padding:"dense"},t.personalRecords[this.props.event.id][e].localRank),r.a.createElement(xe.a,null,r.a.createElement("a",{href:t.person.url,target:"_blank",rel:"noopener noreferrer"},t.person.name)),r.a.createElement(xe.a,{numeric:!0,className:"single"},this.formattedPersonalBest(t,"single")),r.a.createElement(xe.a,{numeric:!0,className:"average"},this.formattedPersonalBest(t,"average")))))))}}class De extends n.Component{constructor(e){super(e),this.handleEventChange=e=>{this.setState({event:e})},this.copyUrl=()=>{ge.a.writeText(this.state.shortUrl)},this.edit=()=>{const e=this.state,t=e.ranking,a=e.peopleData;this.setState({redirectPath:"/edit?"+D({name:t.name,wcaIds:M.a.map(a,"person.wcaId")})})},this.downloadImage=()=>{const e=this.state,t=e.event,a=e.ranking.name.toLowerCase().replace(/\s+/,"-"),n="rankings-".concat(a,"-").concat(t.id,".png");Ee()(this.imageArea,{logging:!1}).then(e=>{const t=document.createElement("a");t.download=n,t.href=e.toDataURL(),t.click()})},this.state={ranking:j(e.location.search),peopleData:[],event:ve[0],shortUrl:window.location.href,redirectPath:null,loading:!0}}componentDidMount(){var e;_(this.state.ranking.wcaIds).then(e=>this.setState({loading:!1,peopleData:this.withLocalRanks(e)})),(e=window.location.href,fetch("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyCgOHkmUMcWKJ0tRlwEs-rzBZ1WA7sTZTI",{method:"POST",body:JSON.stringify({longUrl:e}),headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e.error?Promise.reject(e.error):e.id)).then(e=>this.setState({shortUrl:e}))}withLocalRanks(e){return M.a.each(ve,t=>{M.a.each(["single","average"],a=>{const n=M.a.filter(e,"personalRecords.".concat(t.id,".").concat(a)),r=M.a.sortBy(M.a.map(n,"personalRecords.".concat(t.id,".").concat(a,".worldRank")));M.a.each(n,({personalRecords:e})=>{const n=e[t.id][a];n.localRank=M.a.indexOf(r,n.worldRank)+1})})}),e}render(){const e=this.state,t=e.redirectPath,a=e.ranking,n=e.peopleData,o=e.event,i=e.loading;return t?r.a.createElement(s.c,{to:t}):r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(y.a,{variant:"h5"},a.name,r.a.createElement("div",{style:{display:"inline-block"}},r.a.createElement(he.a,{title:"Copy URL",placement:"right"},r.a.createElement(x.a,{onClick:this.copyUrl},r.a.createElement(ae.a,null,"link"))),r.a.createElement(he.a,{title:"Edit",placement:"right"},r.a.createElement(x.a,{onClick:this.edit},r.a.createElement(ae.a,null,"edit"))),r.a.createElement(he.a,{title:"Download image",placement:"right"},r.a.createElement(x.a,{onClick:this.downloadImage},r.a.createElement(ae.a,null,"photo"))))),r.a.createElement(fe,{value:o,onChange:this.handleEventChange}),r.a.createElement("div",{ref:e=>this.imageArea=e},r.a.createElement(re.a,null,r.a.createElement(je,{peopleData:n,event:o}),i&&r.a.createElement(A.a,null))))}}const Ne=Object(h.createMuiTheme)({palette:{primary:g.a,secondary:E.a}});class Oe extends n.Component{render(){return r.a.createElement(s.a,{basename:"/rankings"},r.a.createElement(h.MuiThemeProvider,{theme:Ne},r.a.createElement(l.a,null),r.a.createElement(P,null),r.a.createElement(d.a,{container:!0,justify:"center"},r.a.createElement(d.a,{item:!0,xs:12,md:8,style:{padding:16}},r.a.createElement(s.d,{exact:!0,path:"/",component:N}),r.a.createElement(s.d,{path:"/edit",component:me}),r.a.createElement(s.d,{path:"/show",component:De})))))}}const Be=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Fe(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(Oe,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/rankings",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("/rankings","/service-worker.js");Be?(!function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Fe(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Fe(e)})}}()}},[[152,1,2]]]);
//# sourceMappingURL=main.d215c3d2.chunk.js.map