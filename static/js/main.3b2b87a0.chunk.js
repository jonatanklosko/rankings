(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{131:function(e,t,n){e.exports=n(308)},136:function(e,t,n){},219:function(e,t,n){},300:function(e,t,n){},308:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(25),c=n.n(o),i=(n(136),n(15)),l=n(16),s=n(22),u=n(21),m=n(23),h=n(24),d=n(126),p=n.n(d),f=n(20),g=n.n(f),v=n(42),b=n(124),k=n.n(b),E=n(125),y=n.n(E),j=n(115),O=n.n(j),w=n(117),C=n.n(w),P=n(27),x=n.n(P),S=n(30),I=n.n(S),R=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(O.a,{position:"static",color:"primary"},r.a.createElement(C.a,null,r.a.createElement(x.a,{variant:"h6",color:"inherit",style:{flexGrow:1}},r.a.createElement(h.b,{to:"/"},"Rankings")),r.a.createElement(I.a,{component:"a",href:"https://github.com/jonatanklosko/rankings",target:"_blank",rel:"noopener"},r.a.createElement("img",{src:"https://png.icons8.com/ios-glyphs/32/ffffff/github.png",alt:"GitHub"}))))}}]),t}(a.Component),F=n(43),W=n.n(F),N=function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,null,[{key:"resultToString",value:function(e,t,n){if("333fm"!==t){if("333mbf"===t){var a=e%100,r=(e=Math.floor(e/100))%1e5,o=99-(e=Math.floor(e/1e5))%100+a,c=o+a,i=this.centisecondsToClockFormat(100*r).replace(/\.00$/,"");return"".concat(o,"/").concat(c," ").concat(i)}return this.centisecondsToClockFormat(e)}switch(n){case"single":return e;case"average":return(e/100).toFixed(2);default:throw new Error("Unrecognized format type: ".concat(n))}}},{key:"centisecondsToClockFormat",value:function(e){var t=new Date(null);return t.setMilliseconds(10*e),t.toISOString().substr(11,11).replace(/^[0:]*(?!\.)/g,"")}},{key:"readWcaIdsFromFile",value:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(e){var n=e.target.result;t(n.match(/\d{4}[A-Za-z]{4}\d{2}/g)||[])},a.onerror=n,a.readAsText(e)})}},{key:"rankingFromSearchParams",value:function(e){var t=new URLSearchParams(e);return{wcaIds:t.get("wcaids")?t.get("wcaids").split(","):[],name:t.get("name")||""}}}]),e}(),B=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).state={redirectPath:null},n.importPeople=function(){n.fileInput.click()},n.handleFileChange=function(e){e.target.files.length>0&&N.readWcaIdsFromFile(e.target.files[0]).then(function(e){return n.setState({redirectPath:"/edit?wcaids=".concat(e.join(","))})})},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return this.state.redirectPath?r.a.createElement(h.c,{to:this.state.redirectPath}):r.a.createElement(g.a,{container:!0,spacing:24,justify:"center"},r.a.createElement(g.a,{item:!0},r.a.createElement(x.a,{variant:"h4"},"What is it?")),r.a.createElement(g.a,{item:!0},r.a.createElement(x.a,{variant:"subtitle1"},"WCA-like rankings created by you! Select a group of people and see how they are doing compared to each other.")),r.a.createElement(g.a,{item:!0},r.a.createElement(g.a,{container:!0,spacing:8},r.a.createElement(g.a,{item:!0},r.a.createElement(W.a,{variant:"outlined",component:h.b,to:"/edit"},"Go ahead and create one!")),r.a.createElement("input",{type:"file",style:{display:"none"},ref:function(t){return e.fileInput=t},onChange:this.handleFileChange}),r.a.createElement(g.a,{item:!0},r.a.createElement(W.a,{variant:"outlined",onClick:this.importPeople},"Import people from file")))))}}]),t}(a.Component),U=n(58),T=n(18),D=n(54),A=n.n(D),M=n(57),L=n.n(M),q=n(9),_=n.n(q),z=n(130),H=n(128),J=function e(t){return _.a.isArray(t)?_.a.map(t,e):_.a.mapValues(_.a.mapKeys(t,function(e,t){return _.a.camelCase(t)}),function(t){return _.a.isObject(t)?e(t):t})},G=new Map,K=function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,null,[{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("".concat("https://www.worldcubeassociation.org/api/v0").concat(e),t).then(function(e){return e.json()}).then(J)})},{key:"searchPeople",value:function(e){return this.fetch("/search/users?persons_table=true&q=".concat(e)).then(function(e){return e.result})}},{key:"getPeopleByWcaIds",value:function(e){var t=this,n=_.a.partition(e,function(e){return G.has(e)}),a=Object(H.a)(n,2),r=a[0],o=a[1],c=_.a.map(r,function(e){return G.get(e)}),i=_.a.map(_.a.chunk(o,100),function(e){return t.fetch("/persons?per_page=100&wca_ids=".concat(e.join(",")))});return Promise.all(i).then(_.a.flatten).then(function(e){return e.map(function(e){var t=e.personalRecords,n=Object(z.a)(e,["personalRecords"]);return Object(U.a)({},n,{personalRecords:_.a.mapKeys(t,function(e,t){return _.a.toLower(t)})})})}).then(function(e){return _.a.each(e,function(e){return G.set(e.person.wcaId,e)}),e.concat(c)})}}]),e}(),V=n(129),Z=n(75),$=n.n(Z),Q=n(76),X=n.n(Q),Y=n(119),ee=n.n(Y),te=n(56),ne=n.n(te),ae=n(55),re=n.n(ae),oe=n(44),ce=n.n(oe),ie=n(29),le=n.n(ie),se=n(118),ue=n.n(se),me=n(127),he=(n(219),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={peopleFound:[]},n.handleChange=n.handleChange.bind(Object(T.a)(Object(T.a)(n))),n.findPeopleDebounced=_.a.debounce(n.findPeople.bind(Object(T.a)(Object(T.a)(n))),300),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"findPeople",value:function(e){var t=this;e?K.searchPeople(e).then(function(e){return t.setState({peopleFound:e})}):this.setState({peopleFound:[]})}},{key:"handleChange",value:function(e,t){var n=t.clearSelection;e&&this.props.onChange(e),this.props.clearOnChange&&n()}},{key:"render",value:function(){var e=this;return r.a.createElement(me.a,{onChange:this.handleChange,itemToString:function(e){return _.a.get(e,"name","")},onInputValueChange:this.findPeopleDebounced},function(t){var n=t.getInputProps,a=t.getItemProps,o=t.isOpen,c=(t.inputValue,t.highlightedIndex);return r.a.createElement("div",{className:"wca-person-select"},r.a.createElement(A.a,n({fullWidth:e.props.fullWidth,label:e.props.label})),o&&r.a.createElement(le.a,{square:!0,className:"options-list"},e.state.peopleFound.map(function(e,t){return r.a.createElement(ue.a,a({item:e,selected:c===t,key:e.id}),r.a.createElement(re.a,{src:e.avatar.thumbUrl}),r.a.createElement(ne.a,{primary:e.name,secondary:e.wcaId}))})))})}}]),t}(a.Component)),de=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"onPersonAdded",value:function(e){this.props.onChange(_.a.uniqBy(Object(V.a)(this.props.people).concat([e]),"wcaId"))}},{key:"onPersonRemoved",value:function(e){this.props.onChange(_.a.reject(this.props.people,{wcaId:e.wcaId}))}},{key:"render",value:function(){var e=this;return r.a.createElement(le.a,{elevation:1,style:{padding:8}},r.a.createElement(g.a,{container:!0,spacing:8},r.a.createElement(g.a,{item:!0,xs:12},r.a.createElement(he,{fullWidth:!0,label:"Add person",clearOnChange:!0,onChange:function(t){return e.onPersonAdded(t)}})),r.a.createElement(g.a,{item:!0,xs:12},r.a.createElement($.a,{dense:!0,style:{maxHeight:200,overflow:"auto"}},this.props.people.map(function(t){return r.a.createElement(X.a,{key:t.wcaId},r.a.createElement(re.a,{src:t.avatar.thumbUrl}),r.a.createElement(ne.a,{primary:t.name}),r.a.createElement(ee.a,null,r.a.createElement(I.a,{onClick:function(){return e.onPersonRemoved(t)}},r.a.createElement(ce.a,null,"delete"))))})))))}}]),t}(a.PureComponent),pe=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={ranking:N.rankingFromSearchParams(n.props.location.search),people:[],redirectPath:null,loading:!0},n.handleSubmit=n.handleSubmit.bind(Object(T.a)(Object(T.a)(n))),n.handleNameChange=n.handleNameChange.bind(Object(T.a)(Object(T.a)(n))),n.handlePeopleChange=n.handlePeopleChange.bind(Object(T.a)(Object(T.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;K.getPeopleByWcaIds(this.state.ranking.wcaIds).then(function(t){return e.setState({loading:!1,people:_.a.map(t,"person")})})}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.setState({redirectPath:"/show?name=".concat(encodeURIComponent(this.state.ranking.name),"&wcaids=").concat(_.a.map(this.state.people,"wcaId").join(","))})}},{key:"handleNameChange",value:function(e){var t=this.state.ranking;this.setState({ranking:Object(U.a)({},t,{name:e.target.value})})}},{key:"handlePeopleChange",value:function(e){this.setState({people:e})}},{key:"render",value:function(){var e=this.state,t=e.redirectPath,n=e.ranking,a=e.people,o=e.loading;return t?r.a.createElement(h.c,{to:t}):r.a.createElement("div",null,r.a.createElement(x.a,{variant:"h5"},"Edit ranking"),r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(g.a,{container:!0,direction:"column",spacing:16},r.a.createElement(g.a,{item:!0},r.a.createElement(A.a,{fullWidth:!0,label:"Ranking name",value:n.name,onChange:this.handleNameChange})),r.a.createElement(g.a,{item:!0},r.a.createElement(x.a,{variant:"subtitle2",style:{marginBottom:8}},"People"),o?r.a.createElement(L.a,null):r.a.createElement(de,{people:a,onChange:this.handlePeopleChange})),r.a.createElement(g.a,{item:!0},r.a.createElement(W.a,{type:"submit",variant:"outlined"},"Done")))))}}]),t}(a.Component),fe=n(45),ge=n.n(fe),ve=n(120),be=n.n(ve),ke=function(){function e(){Object(i.a)(this,e)}return Object(l.a)(e,null,[{key:"shorten",value:function(e){return fetch("https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyCgOHkmUMcWKJ0tRlwEs-rzBZ1WA7sTZTI",{method:"POST",body:JSON.stringify({longUrl:e}),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){return e.error?Promise.reject(e.error):e.id})}}]),e}(),Ee=[{id:"333",name:"Rubik's Cube",icon:"event-333"},{id:"222",name:"2x2x2 Cube",icon:"event-222"},{id:"444",name:"4x4x4 Cube",icon:"event-444"},{id:"555",name:"5x5x5 Cube",icon:"event-555"},{id:"666",name:"6x6x6 Cube",icon:"event-666"},{id:"777",name:"7x7x7 Cube",icon:"event-777"},{id:"333bf",name:"3x3x3 Blindfolded",icon:"event-333bf"},{id:"333fm",name:"3x3x3 Fewest Moves",icon:"event-333fm"},{id:"333oh",name:"3x3x3 One-Handed",icon:"event-333oh"},{id:"333ft",name:"3x3x3 With Feet",icon:"event-333ft"},{id:"minx",name:"Megaminx",icon:"event-minx"},{id:"pyram",name:"Pyraminx",icon:"event-pyram"},{id:"clock",name:"Rubik's Clock",icon:"event-clock"},{id:"skewb",name:"Skewb",icon:"event-skewb"},{id:"sq1",name:"Square-1",icon:"event-sq1"},{id:"444bf",name:"4x4x4 Blindfolded",icon:"event-444bf"},{id:"555bf",name:"5x5x5 Blindfolded",icon:"event-555bf"},{id:"333mbf",name:"3x3x3 Multi-Blind",icon:"event-333mbf"}],ye=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,Ee.map(function(t){return r.a.createElement(ge.a,{title:t.name,placement:"top",key:t.id},r.a.createElement(I.a,{onClick:function(){return e.props.onChange(t)}},r.a.createElement("span",{className:"cubing-icon ".concat(t.icon),style:{opacity:t.id===e.props.value.id?1:.3}})))}))}}]),t}(a.Component),je=n(121),Oe=n.n(je),we=n(123),Ce=n.n(we),Pe=n(31),xe=n.n(Pe),Se=n(122),Ie=n.n(Se),Re=n(77),Fe=n.n(Re),We=(n(300),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={format:"single"},n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"setFormat",value:function(e){this.setState({format:e})}},{key:"formattedPersonalBest",value:function(e,t){var n=this.props.event.id,a=_.a.get(e,"personalRecords.".concat(n,".").concat(t,".best"));return a?N.resultToString(a,n,t):""}},{key:"peopleData",value:function(){var e=this.props.event.id;return _()(this.props.peopleData).filter("personalRecords.".concat(e,".").concat(this.state.format)).orderBy(["personalRecords.".concat(e,".").concat(this.state.format,".localRank")]).value()}},{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"ranking-table-container"},r.a.createElement(Oe.a,{className:"sort-by-".concat(this.state.format)},r.a.createElement(Ie.a,{className:"ranking-table-head"},r.a.createElement(Fe.a,null,r.a.createElement(xe.a,{padding:"dense"}),r.a.createElement(xe.a,null,"Name"),r.a.createElement(xe.a,{numeric:!0,className:"single",onClick:function(){return e.setFormat("single")}},"Single"),r.a.createElement(xe.a,{numeric:!0,className:"average",onClick:function(){return e.setFormat("average")}},"Average"))),r.a.createElement(Ce.a,null,this.peopleData().map(function(t){return r.a.createElement(Fe.a,{key:t.person.wcaId},r.a.createElement(xe.a,{padding:"dense"},t.personalRecords[e.props.event.id][e.state.format].localRank),r.a.createElement(xe.a,null,r.a.createElement("a",{href:t.person.url,target:"_blank",rel:"noopener noreferrer"},t.person.name)),r.a.createElement(xe.a,{numeric:!0,className:"single"},e.formattedPersonalBest(t,"single")),r.a.createElement(xe.a,{numeric:!0,className:"average"},e.formattedPersonalBest(t,"average")))}))))}}]),t}(a.Component)),Ne=function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).state={ranking:N.rankingFromSearchParams(n.props.location.search),peopleData:[],event:Ee[0],shortUrl:window.location.href,redirectPath:null,loading:!0},n.handleEventChange=n.handleEventChange.bind(Object(T.a)(Object(T.a)(n))),n.copyUrl=n.copyUrl.bind(Object(T.a)(Object(T.a)(n))),n.edit=n.edit.bind(Object(T.a)(Object(T.a)(n))),n}return Object(m.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;K.getPeopleByWcaIds(this.state.ranking.wcaIds).then(function(t){return e.setState({loading:!1,peopleData:e.withLocalRanks(t)})}),ke.shorten(window.location.href).then(function(t){return e.setState({shortUrl:t})})}},{key:"withLocalRanks",value:function(e){return _.a.each(Ee,function(t){_.a.each(["single","average"],function(n){var a=_.a.filter(e,"personalRecords.".concat(t.id,".").concat(n)),r=_.a.sortBy(_.a.map(a,"personalRecords.".concat(t.id,".").concat(n,".worldRank")));_.a.each(a,function(e){var a=e.personalRecords[t.id][n];a.localRank=_.a.indexOf(r,a.worldRank)+1})})}),e}},{key:"handleEventChange",value:function(e){this.setState({event:e})}},{key:"copyUrl",value:function(){be.a.writeText(this.state.shortUrl)}},{key:"edit",value:function(){this.setState({redirectPath:"/edit?name=".concat(encodeURIComponent(this.state.ranking.name),"&wcaids=").concat(_.a.map(this.state.peopleData,"person.wcaId").join(","))})}},{key:"render",value:function(){var e=this.state,t=e.redirectPath,n=e.ranking,a=e.peopleData,o=e.event,c=e.loading;return t?r.a.createElement(h.c,{to:t}):r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(x.a,{variant:"h5"},n.name,r.a.createElement("div",{style:{display:"inline-block"}},r.a.createElement(ge.a,{title:"Copy URL",placement:"right"},r.a.createElement(I.a,{onClick:this.copyUrl},r.a.createElement(ce.a,null,"link"))),r.a.createElement(ge.a,{title:"Edit",placement:"right"},r.a.createElement(I.a,{onClick:this.edit},r.a.createElement(ce.a,null,"edit"))))),r.a.createElement(ye,{value:o,onChange:this.handleEventChange}),r.a.createElement(le.a,null,r.a.createElement(We,{peopleData:a,event:o}),c&&r.a.createElement(L.a,null)))}}]),t}(a.Component),Be=Object(v.createMuiTheme)({palette:{primary:k.a,secondary:y.a}}),Ue=function(e){function t(){return Object(i.a)(this,t),Object(s.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){return r.a.createElement(h.a,{basename:"/rankings"},r.a.createElement(v.MuiThemeProvider,{theme:Be},r.a.createElement(p.a,null),r.a.createElement(R,null),r.a.createElement(g.a,{container:!0,justify:"center"},r.a.createElement(g.a,{item:!0,xs:12,md:8,style:{padding:16}},r.a.createElement(h.d,{exact:!0,path:"/",component:B}),r.a.createElement(h.d,{path:"/edit",component:pe}),r.a.createElement(h.d,{path:"/show",component:Ne})))))}}]),t}(a.Component),Te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function De(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}c.a.render(r.a.createElement(Ue,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/rankings",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/rankings","/service-worker.js");Te?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):De(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):De(e)})}}()}},[[131,2,1]]]);
//# sourceMappingURL=main.3b2b87a0.chunk.js.map