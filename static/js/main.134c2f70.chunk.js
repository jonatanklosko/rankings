(this.webpackJsonprankings=this.webpackJsonprankings||[]).push([[0],{136:function(e,t,a){e.exports=a.p+"static/media/github.26a51923.svg"},153:function(e,t,a){e.exports=a(357)},159:function(e,t,a){},241:function(e,t,a){},350:function(e,t,a){},357:function(e,t,a){"use strict";a.r(t);a(154);var n=a(0),r=a.n(n),o=a(19),i=a.n(o),c=(a(159),a(18)),s=a(149),l=a.n(s),m=a(17),d=a.n(m),h=a(44),p=a(147),u=a.n(p),g=a(148),E=a.n(g),v=a(137),f=a.n(v),w=a(139),k=a.n(w),b=a(21),C=a.n(b),x=a(23),y=a.n(x),P=a(136),R=a.n(P);class I extends n.Component{render(){return r.a.createElement(f.a,{position:"static",color:"primary"},r.a.createElement(k.a,null,r.a.createElement(C.a,{variant:"h6",color:"inherit",style:{flexGrow:1}},r.a.createElement(c.b,{to:"/"},"Rankings")),r.a.createElement(y.a,{component:"a",href:"https://github.com/jonatanklosko/rankings",target:"_blank",rel:"noopener noreferrer"},r.a.createElement("img",{src:R.a,height:"32",width:"32",alt:"GitHub"}))))}}var S=a(45),D=a.n(S);const j=e=>{const t=new Date(null);return t.setMilliseconds(10*e),t.toISOString().substr(11,11).replace(/^[0:]*(?!\.)/g,"")},F=e=>{const t=new URLSearchParams(e);return{wcaIds:t.get("wcaids")?(a=t.get("wcaids").split(","),[...new Set(a)]):[],name:t.get("name")||""};var a},N=({name:e,wcaIds:t})=>new URLSearchParams({name:e,wcaids:t.join(",")}).toString();class B extends n.Component{constructor(...e){super(...e),this.state={redirectPath:null},this.importPeople=()=>{this.fileInput.click()},this.handleFileChange=e=>{var t;e.target.files.length>0&&(t=e.target.files[0],new Promise((e,a)=>{const n=new FileReader;n.onload=t=>{const a=t.target.result;e(a.match(/\d{4}[A-Za-z]{4}\d{2}/g)||[])},n.onerror=a,n.readAsText(t)})).then(e=>this.setState({redirectPath:"/edit?"+N({name:"",wcaIds:e})}))}}render(){const e=this.state.redirectPath;return e?r.a.createElement(c.c,{to:e}):r.a.createElement(d.a,{container:!0,spacing:24,justify:"center"},r.a.createElement(d.a,{item:!0},r.a.createElement(C.a,{variant:"h4"},"What is it?")),r.a.createElement(d.a,{item:!0},r.a.createElement(C.a,{variant:"subtitle1"},r.a.createElement("a",{href:"https://www.worldcubeassociation.org/results/events.php",target:"_blank",rel:"noopener noreferrer"},"WCA"),"-like rankings created by you! Select a group of people and see how they are doing compared to each other.")),r.a.createElement(d.a,{item:!0},r.a.createElement(d.a,{container:!0,spacing:8},r.a.createElement(d.a,{item:!0},r.a.createElement(D.a,{variant:"outlined",component:c.b,to:"/edit"},"Go ahead and create one!")),r.a.createElement("input",{type:"file",style:{display:"none"},ref:e=>this.fileInput=e,onChange:this.handleFileChange}),r.a.createElement(d.a,{item:!0},r.a.createElement(D.a,{variant:"outlined",onClick:this.importPeople},"Import people from file")))))}}var O=a(63),A=a(59),U=a.n(A),W=a(62),M=a.n(W),L=a(8),T=a.n(L),q=a(152),_=a(150);const G=new Map,H=e=>{const t=T.a.partition(e,e=>G.has(e)),a=Object(_.a)(t,2),n=a[0],r=a[1].slice(0,500),o=T.a.map(n,e=>G.get(e)),i=T.a.map(T.a.chunk(r,100),e=>V("/persons?per_page=100&wca_ids=".concat(e.join(","))));return Promise.all(i).then(T.a.flatten).then(e=>e.map(e=>{let t=e.personalRecords,a=Object(q.a)(e,["personalRecords"]);return Object(O.a)({},a,{personalRecords:T.a.mapKeys(t,(e,t)=>T.a.toLower(t))})})).then(e=>(T.a.each(e,e=>G.set(e.person.wcaId,e)),e.concat(o)))},V=(e,t={})=>fetch("".concat("https://www.worldcubeassociation.org/api/v0").concat(e),t).then(e=>e.json()).then(z),z=e=>T.a.isArray(e)?T.a.map(e,z):T.a.mapValues(T.a.mapKeys(e,(e,t)=>T.a.camelCase(t)),e=>T.a.isObject(e)?z(e):e);var J=a(84),K=a.n(J),$=a(85),Q=a.n($),Z=a(141),X=a.n(Z),Y=a(61),ee=a.n(Y),te=a(60),ae=a.n(te),ne=a(35),re=a.n(ne),oe=a(27),ie=a.n(oe),ce=a(140),se=a.n(ce),le=a(151);a(241);class me extends n.Component{constructor(e){super(e),this.state={peopleFound:[]},this.findPeople=e=>{e?(e=>V("/search/users?persons_table=true&q=".concat(e)).then(e=>e.result))(e).then(e=>this.setState({peopleFound:e})):this.setState({peopleFound:[]})},this.handleChange=(e,{clearSelection:t})=>{const a=this.props,n=a.onChange,r=a.clearOnChange;e&&n(e),r&&t()},this.findPeopleDebounced=T.a.debounce(this.findPeople,300)}render(){const e=this.props,t=e.fullWidth,a=e.label;return r.a.createElement(le.a,{onChange:this.handleChange,itemToString:e=>T.a.get(e,"name",""),onInputValueChange:this.findPeopleDebounced},({getInputProps:e,getItemProps:n,isOpen:o,inputValue:i,highlightedIndex:c})=>r.a.createElement("div",{className:"wca-person-select"},r.a.createElement(U.a,e({fullWidth:t,label:a})),o&&r.a.createElement(ie.a,{square:!0,className:"options-list"},this.state.peopleFound.map((e,t)=>r.a.createElement(se.a,n({item:e,selected:c===t,key:e.id}),r.a.createElement(ae.a,{src:e.avatar.thumbUrl}),r.a.createElement(ee.a,{primary:e.name,secondary:e.wcaId}))))))}}class de extends n.PureComponent{onPersonAdded(e){this.props.onChange(T.a.uniqBy([...this.props.people,e],"wcaId"))}onPersonRemoved(e){this.props.onChange(T.a.reject(this.props.people,{wcaId:e.wcaId}))}render(){return r.a.createElement(ie.a,{elevation:1,style:{padding:8}},r.a.createElement(d.a,{container:!0,spacing:8},r.a.createElement(d.a,{item:!0,xs:12},r.a.createElement(me,{fullWidth:!0,label:"Add person",clearOnChange:!0,onChange:e=>this.onPersonAdded(e)})),r.a.createElement(d.a,{item:!0,xs:12},r.a.createElement(K.a,{dense:!0,style:{maxHeight:200,overflow:"auto"}},T.a.sortBy(this.props.people,"name").map(e=>r.a.createElement(Q.a,{key:e.wcaId},r.a.createElement(ae.a,{src:e.avatar.thumbUrl}),r.a.createElement(ee.a,{primary:e.name}),r.a.createElement(X.a,null,r.a.createElement(y.a,{onClick:()=>this.onPersonRemoved(e)},r.a.createElement(re.a,null,"delete")))))))))}}class he extends n.Component{constructor(e){super(e),this.handleSubmit=e=>{e.preventDefault();const t=this.state,a=t.ranking,n=t.people;this.setState({redirectPath:"/show?"+N({name:a.name,wcaIds:T.a.map(n,"wcaId")})})},this.handleNameChange=e=>{const t=this.state.ranking;this.setState({ranking:Object(O.a)({},t,{name:e.target.value})})},this.handlePeopleChange=e=>{this.setState({people:e})},this.state={ranking:F(e.location.search),people:[],redirectPath:null,loading:!0}}componentDidMount(){H(this.state.ranking.wcaIds).then(e=>this.setState({loading:!1,people:T.a.map(e,"person")}))}render(){const e=this.state,t=e.redirectPath,a=e.ranking,n=e.people,o=e.loading;return t?r.a.createElement(c.c,{to:t}):r.a.createElement("div",null,r.a.createElement(C.a,{variant:"h5"},"Edit ranking"),r.a.createElement("form",{onSubmit:this.handleSubmit},r.a.createElement(d.a,{container:!0,direction:"column",spacing:16},r.a.createElement(d.a,{item:!0},r.a.createElement(U.a,{fullWidth:!0,label:"Ranking name",value:a.name,onChange:this.handleNameChange})),r.a.createElement(d.a,{item:!0},r.a.createElement(C.a,{variant:"subtitle2",style:{marginBottom:8}},"People"),o?r.a.createElement(M.a,null):r.a.createElement(de,{people:n,onChange:this.handlePeopleChange})),r.a.createElement(d.a,{item:!0},r.a.createElement(D.a,{type:"submit",variant:"outlined"},"Done")))))}}var pe=a(36),ue=a.n(pe),ge=a(142),Ee=a.n(ge),ve=a(143),fe=a.n(ve);var we=[{id:"333",name:"Rubik's Cube",icon:"event-333"},{id:"222",name:"2x2x2 Cube",icon:"event-222"},{id:"444",name:"4x4x4 Cube",icon:"event-444"},{id:"555",name:"5x5x5 Cube",icon:"event-555"},{id:"666",name:"6x6x6 Cube",icon:"event-666"},{id:"777",name:"7x7x7 Cube",icon:"event-777"},{id:"333bf",name:"3x3x3 Blindfolded",icon:"event-333bf"},{id:"333fm",name:"3x3x3 Fewest Moves",icon:"event-333fm"},{id:"333oh",name:"3x3x3 One-Handed",icon:"event-333oh"},{id:"333ft",name:"3x3x3 With Feet",icon:"event-333ft"},{id:"minx",name:"Megaminx",icon:"event-minx"},{id:"pyram",name:"Pyraminx",icon:"event-pyram"},{id:"clock",name:"Rubik's Clock",icon:"event-clock"},{id:"skewb",name:"Skewb",icon:"event-skewb"},{id:"sq1",name:"Square-1",icon:"event-sq1"},{id:"444bf",name:"4x4x4 Blindfolded",icon:"event-444bf"},{id:"555bf",name:"5x5x5 Blindfolded",icon:"event-555bf"},{id:"333mbf",name:"3x3x3 Multi-Blind",icon:"event-333mbf"}];class ke extends n.Component{render(){return r.a.createElement("div",null,we.map(e=>r.a.createElement(ue.a,{title:e.name,placement:"top",key:e.id},r.a.createElement(y.a,{onClick:()=>this.props.onChange(e)},r.a.createElement("span",{className:"cubing-icon ".concat(e.icon),style:{opacity:e.id===this.props.value.id?1:.3}})))))}}var be=a(144),Ce=a.n(be),xe=a(146),ye=a.n(xe),Pe=a(24),Re=a.n(Pe),Ie=a(145),Se=a.n(Ie),De=a(86),je=a.n(De);a(350);class Fe extends n.Component{constructor(...e){super(...e),this.state={format:"single"}}setFormat(e){this.setState({format:e})}formattedPersonalBest(e,t){const a=this.props.event,n=T.a.get(e,"personalRecords.".concat(a.id,".").concat(t,".best"));return n?((e,t,a)=>{if("333fm"!==t){if("333mbf"===t){const t=e%100,a=(e=Math.floor(e/100))%1e5,n=99-(e=Math.floor(e/1e5))%100+t,r=n+t,o=j(100*a).replace(/\.00$/,"");return"".concat(n,"/").concat(r," ").concat(o)}return j(e)}switch(a){case"single":return e;case"average":return(e/100).toFixed(2);default:throw new Error("Unrecognized format type: ".concat(a))}})(n,a.id,t):""}peopleDataForEvent(){const e=this.props,t=e.event,a=e.peopleData,n=this.state.format;return T()(a).filter("personalRecords.".concat(t.id,".").concat(n)).orderBy(["personalRecords.".concat(t.id,".").concat(n,".localRank")]).value()}render(){const e=this.state.format;return r.a.createElement("div",{className:"ranking-table-container"},r.a.createElement(Ce.a,{className:"sort-by-".concat(e)},r.a.createElement(Se.a,{className:"ranking-table-head"},r.a.createElement(je.a,null,r.a.createElement(Re.a,{padding:"dense"}),r.a.createElement(Re.a,null,"Name"),r.a.createElement(Re.a,{numeric:!0,className:"single",onClick:()=>this.setFormat("single")},"Single"),r.a.createElement(Re.a,{numeric:!0,className:"average",onClick:()=>this.setFormat("average")},"Average"))),r.a.createElement(ye.a,null,this.peopleDataForEvent().map(t=>r.a.createElement(je.a,{key:t.person.wcaId},r.a.createElement(Re.a,{padding:"dense"},t.personalRecords[this.props.event.id][e].localRank),r.a.createElement(Re.a,null,r.a.createElement("a",{href:t.person.url,target:"_blank",rel:"noopener noreferrer"},t.person.name)),r.a.createElement(Re.a,{numeric:!0,className:"single"},this.formattedPersonalBest(t,"single")),r.a.createElement(Re.a,{numeric:!0,className:"average"},this.formattedPersonalBest(t,"average")))))))}}class Ne extends n.Component{constructor(e){super(e),this.handleEventChange=e=>{this.setState({event:e})},this.copyUrl=()=>{Ee.a.writeText(this.state.shortUrl)},this.edit=()=>{const e=this.state,t=e.ranking,a=e.peopleData;this.setState({redirectPath:"/edit?"+N({name:t.name,wcaIds:T.a.map(a,"person.wcaId")})})},this.downloadImage=()=>{const e=this.state,t=e.event,a=e.ranking.name.toLowerCase().replace(/\s+/,"-"),n="rankings-".concat(a,"-").concat(t.id,".png");fe()(this.imageArea,{logging:!1}).then(e=>{const t=document.createElement("a");t.download=n,t.href=e.toDataURL(),t.click()})},this.state={ranking:F(e.location.search),peopleData:[],event:we[0],shortUrl:window.location.href,redirectPath:null,loading:!0}}componentDidMount(){H(this.state.ranking.wcaIds).then(e=>this.setState({loading:!1,peopleData:this.withLocalRanks(e)}))}withLocalRanks(e){return T.a.each(we,t=>{T.a.each(["single","average"],a=>{const n=T.a.filter(e,"personalRecords.".concat(t.id,".").concat(a)),r=T.a.sortBy(T.a.map(n,"personalRecords.".concat(t.id,".").concat(a,".worldRank")));T.a.each(n,({personalRecords:e})=>{const n=e[t.id][a];n.localRank=T.a.indexOf(r,n.worldRank)+1})})}),e}render(){const e=this.state,t=e.redirectPath,a=e.ranking,n=e.peopleData,o=e.event,i=e.loading;return t?r.a.createElement(c.c,{to:t}):r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement(C.a,{variant:"h5"},a.name,r.a.createElement("div",{style:{display:"inline-block"}},r.a.createElement(ue.a,{title:"Copy URL",placement:"right"},r.a.createElement(y.a,{onClick:this.copyUrl},r.a.createElement(re.a,null,"link"))),r.a.createElement(ue.a,{title:"Edit",placement:"right"},r.a.createElement(y.a,{onClick:this.edit},r.a.createElement(re.a,null,"edit"))),r.a.createElement(ue.a,{title:"Download image",placement:"right"},r.a.createElement(y.a,{onClick:this.downloadImage},r.a.createElement(re.a,null,"photo"))))),r.a.createElement(ke,{value:o,onChange:this.handleEventChange}),r.a.createElement("div",{ref:e=>this.imageArea=e},r.a.createElement(ie.a,null,r.a.createElement(Fe,{peopleData:n,event:o}),i&&r.a.createElement(M.a,null))))}}const Be=Object(h.createMuiTheme)({palette:{primary:u.a,secondary:E.a}});class Oe extends n.Component{render(){return r.a.createElement(c.a,{basename:"/rankings"},r.a.createElement(h.MuiThemeProvider,{theme:Be},r.a.createElement(l.a,null),r.a.createElement(I,null),r.a.createElement(d.a,{container:!0,justify:"center"},r.a.createElement(d.a,{item:!0,xs:12,md:8,style:{padding:16}},r.a.createElement(c.d,{exact:!0,path:"/",component:B}),r.a.createElement(c.d,{path:"/edit",component:he}),r.a.createElement(c.d,{path:"/show",component:Ne})))))}}const Ae=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ue(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=()=>{const t=e.installing;t.onstatechange=()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(e=>{console.error("Error during service worker registration:",e)})}i.a.render(r.a.createElement(Oe,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/rankings",window.location).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="".concat("/rankings","/service-worker.js");Ae?(!function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):Ue(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(()=>{console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Ue(e)})}}()}},[[153,1,2]]]);
//# sourceMappingURL=main.134c2f70.chunk.js.map